@{
  Layout = "~/Views/Shared/_Layout.cshtml";
  ViewBag.Title = "Build Radiator";
  ViewBag.AngularApp = "BuildRadiator";
  ViewBag.AngularController = "DashboardController";
}

<div flex>
  <md-grid-list md-cols="6" md-row-height="2:2" md-gutter="8px" style="margin: 8px">
    <md-grid-tile md-rowspan="{{ tile.rowSpan }}" md-colspan="{{ tile.columnSpan }}"
                  class="build-tile"
                  ng-repeat-start="tile in ctrl.tiles"
                  ng-if="tile.type == 'Configit.BuildRadiator.Model.BuildTile'"
                  ng-class="( tile.error ? 'error-tile' : tile.build.status ) + ( tile.build.previouslyFailing ? ' previously-failing' : '' )">

      <div ng-if="tile.error">
        {{ tile.error.Message }}
      </div>

      <div layout="column" layout-fill ng-if="!tile.error">
        @* Failed *@
        <div class="user-list" ng-if="tile.build.status === 'failed'">
          <gravatar email="tile.build.investigator" title="{{ tile.build.investigator }}" size="100" ng-if="tile.build.investigator"></gravatar><gravatar email="username" title="{{ username }}" ng-repeat="username in tile.build.committers | limitTo:ctrl.committerLimit" size="50" ng-if="!tile.build.investigator"></gravatar><div class="committer-overflow" ng-if="!tile.build.investigator && tile.build.committers.length > ctrl.committerLimit">{{ tile.build.committers.length }}</div>
        </div>

        @* In Progress *@
        <div class="messages in-progress" ng-if="tile.build.status === 'inProgress'">
          Started <strong>{{ tile.build.start | fromNow }}</strong><br/>
          Should finish <strong>{{ tile.build.end | fromNow }}</strong>
        </div>

        @* Success *@
        <div class="messages success" ng-if="tile.build.status === 'success'">
          Built <strong>{{ tile.build.end | fromNow }}</strong><br/>
          Took <strong>{{ tile.build.end | fromTime:tile.build.start }}</strong>
        </div>

        <div flex class="progress-box" layout="column" layout-align="end center" ng-if="tile.build.status === 'inProgress'">
          <md-progress-linear md-mode="determinate" value="{{ tile.build.percentComplete }}"></md-progress-linear>
        </div>
      </div>

      <md-grid-tile-footer>
        <div layout="row">
          <build-status-icon status="tile.build.status"></build-status-icon>
          <h3 flex>{{ ::tile.title }}</h3>
        </div>
      </md-grid-tile-footer>
    </md-grid-tile>

    <md-grid-tile md-rowspan="{{ tile.rowSpan }}" md-colspan="{{ tile.columnSpan }}"
                  ng-if="tile.type == 'Configit.BuildRadiator.Model.MessageTile'"
                  ng-class="( tile.error ? 'error-tile ' : 'message-tile ' )  + tile.message.classes.join( ' ' )">
      <div flex ng-if="!tile.error" class="message-content" ng-bind-html="tile.message.contentHtml"></div>
      <md-grid-tile-footer>
        <h3>{{ ::tile.title }}</h3>
      </md-grid-tile-footer>
    </md-grid-tile>

    <md-grid-tile md-rowspan="{{ tile.rowSpan }}" md-colspan="{{ tile.columnSpan }}"
                  ng-if="tile.type == 'Configit.BuildRadiator.Model.ClockTile'"
                  ng-repeat-end
                  ng-class="( tile.error ? 'error-tile ' : 'clock-tile ' )">
      <div flex ng-if="!tile.error" class="message-content">
          <clock timezone="tile.timeZoneId" ></clock>
       
              
          
      </div>
      <md-grid-tile-footer ng-model="showEdit" ng-mouseover="showEdit=true" ng-mouseleave="showEdit=false">
          <h3 contenteditable="{{showEdit}}">{{ ::tile.title }}</h3>
          
      </md-grid-tile-footer>
    </md-grid-tile>
  </md-grid-list>
</div>

@section AdditionalScripts {
  <script src="~/signalr/hubs"></script>
}
